!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.handWrite=e():t.handWrite=e()}(this,function(){return function(t){function e(n){if(i[n])return i[n].exports;var a=i[n]={i:n,l:!1,exports:{}};return t[n].call(a.exports,a,a.exports,e),a.l=!0,a.exports}var i={};return e.m=t,e.c=i,e.d=function(t,i,n){e.o(t,i)||Object.defineProperty(t,i,{configurable:!1,enumerable:!0,get:n})},e.n=function(t){var i=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(i,"a",i),i},e.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},e.p="",e(e.s=0)}([function(t,e,i){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var a=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),s=console.log.bind(null,"[handWrite]"),o=Math.PI,r=function(){function t(e){n(this,t),this.canvas=e;var i=e.getContext("2d"),a=window.devicePixelRatio,s=e.offsetWidth,o=e.offsetHeight;a&&(e.style.width=s+"px",e.style.height=o+"px",e.height=o*a,e.width=s*a,i.scale(a,a)),this.ctx=i,i.fillStyle="#f00",i.strokeStyle="#f00",i.lineCap="round",i.lineJoin="round",i.lineWidth=6,this.lastPos={},this.drawabled=!1,this.isHandWrittingModel=!0,this.bindEvents()}return a(t,[{key:"bindEvents",value:function(){this.canvas.addEventListener("touchstart",this.start.bind(this),!1),this.canvas.addEventListener("mousedown",this.start.bind(this),!1),this.canvas.addEventListener("touchend",this.up.bind(this),!1),this.canvas.addEventListener("mouseup",this.up.bind(this),!1),this.canvas.addEventListener("mouseleave",this.up.bind(this),!1)}},{key:"__isMobile",value:function(){return/android|iphone|ipad|ipod|blackberry|iemobile|opera mini/i.test(navigator.userAgent.toLowerCase())}},{key:"draw",value:function(t){this.ctx,this.lastPos;this.isHandWrittingModel?this.drawWithArc(t):this.drawWithLine(t)}},{key:"drawWithLine",value:function(t){var e=this.ctx;e.lineTo(t.x,t.y),e.stroke()}},{key:"drawWithArc",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3,i=this.ctx,n=this.lastPos,a=this.lastR,s=void 0===a?0:a,r=this.getDistance(t,n);if(r<2)return!1;for(var h=r>30?1:r/30,u=e+2.5*e*(1-h),d=Math.round(r/2)+1,v=0,c=0;v<d;v++){var l=n.x+(t.x-n.x)/d*v,f=n.y+(t.y-n.y)/d*v;c=s+(u-s)/d*v,i.beginPath(),i.arc(l,f,c,0,2*o),i.fill()}this.lastR=u,n.x=t.x,n.y=t.y}},{key:"rafDraw",value:function(t){var e=this;requestAnimationFrame(function(){if(e.drawabled){var i=e.getCoordinate(t);e.draw(i)}})}},{key:"throttleDraw",value:function(t){this.rafDraw(t)}},{key:"start",value:function(t){t.preventDefault();var e=this.getCoordinate(t);s("start",e),this.drawabled=!0,this.ctx.beginPath(),this.ctx.moveTo(e.x,e.y),this.draw(e),this.canvas.addEventListener("touchmove",this.move.bind(this),!1),this.canvas.addEventListener("mousemove",this.move.bind(this),!1)}},{key:"move",value:function(t){t.preventDefault(),this.throttleDraw(t)}},{key:"up",value:function(t){if(t.preventDefault(),this.drawabled){var e=this.getCoordinate(t);this.draw(e)}this.drawabled=!1,this.lastPos={},this.lastR=0,this.canvas.removeEventListener("touchmove",this.move.bind(this),!1),this.canvas.removeEventListener("mousemove",this.move.bind(this),!1)}},{key:"getCoordinate",value:function(t){var e=this.canvas.getBoundingClientRect(),i=e.left,n=e.top;return t=this.__isMobile()?t.touches[0]:t,{x:t.clientX-i+.5,y:t.clientY-n+.5}}},{key:"getDistance",value:function(t,e){if(!t||!e)return 0;var i=t.x-e.x,n=t.y-e.y;return Math.sqrt(Math.pow(i,2)+Math.pow(n,2))}},{key:"destroy",value:function(){this.canvas.removeEventListener("touchstart",this.start.bind(this),!1),this.canvas.removeEventListener("mousedown",this.start.bind(this),!1),this.canvas.removeEventListener("touchmove",this.move.bind(this),!1),this.canvas.removeEventListener("mousemove",this.move.bind(this),!1),this.canvas.removeEventListener("touchend",this.up.bind(this),!1),this.canvas.removeEventListener("mouseup",this.up.bind(this),!1)}},{key:"clear",value:function(){var t=this.canvas;this.ctx.clearRect(0,0,t.width,t.height)}},{key:"handWrittingModel",value:function(){this.isHandWrittingModel=!0}},{key:"linearModel",value:function(){this.isHandWrittingModel=!1}},{key:"formatType",value:function(t){return t=t.toLowerCase().replace(/jpg/i,"jpeg"),t="image/"+t.match(/png|jpeg|bmp|gif/)[0]}},{key:"getImgData",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"png",e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.canvas;return t=this.formatType(t),e.toDataURL(t)}},{key:"downloadImage",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"png",e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.canvas;t=this.formatType(t);var i=e.toDataURL(t).replace(t,"image/octet-stream");document.location.href=i}}]),t}();e.default=r}])});